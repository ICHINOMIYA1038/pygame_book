---
title: "第2章：敵があらわれた！ - スライムとたたかおう"
---

# 第2章：敵があらわれた！ - スライムとたたかおう

前回は勇者を作りました。今回は、敵を作って、バトルシステムを実装します！

## 今回作るもの

![バトル画面](/images/python-rpg-game/02_battle.png)

- スライムと戦うバトルシステム
- コマンド選択（こうげき/にげる）
- ダメージエフェクトとアニメーション
- 画面の揺れ効果

## プログラムの説明

### 1. バトルの状態管理

```python
self.turn_phase = "SELECT"  # SELECT, HERO_ACTION, ENEMY_ACTION, CHECK
```

バトルには以下の段階があります：
- `SELECT`: コマンドを選んでいる
- `HERO_ACTION`: 勇者が行動している
- `ENEMY_ACTION`: 敵が行動している

### 2. ダメージ計算

```python
damage = random.randint(self.hero_attack - 5, self.hero_attack + 5)
self.enemy_hp -= damage
```

ダメージは基本攻撃力にランダムな値を加えて計算します。
これにより、毎回違うダメージになって面白くなります。

### 3. アニメーション効果

```python
# 画面の揺れ
if self.shake_target == "enemy" and self.shake_timer > 0:
    x += random.randint(-5, 5)
    y += random.randint(-5, 5)
```

攻撃を受けたキャラクターが揺れるエフェクトです。
`shake_timer`で揺れる時間を管理しています。

### 4. エフェクトの描画

```python
def add_effect(self, effect_type, x, y):
    self.effects.append({
        "type": effect_type,
        "x": x,
        "y": y,
        "timer": 30
    })
```

斬撃やヒットなどのエフェクトを管理します。
timerが0になるまで表示され、徐々に薄くなります。

## ゲームの流れ

1. **名前入力** → 勇者の名前を決める
2. **バトル開始** → スライムが出現
3. **コマンド選択** → 「こうげき」か「にげる」を選ぶ
4. **ダメージ計算** → ランダムなダメージを与える
5. **敵のターン** → スライムが反撃
6. **勝利/敗北** → HPが0になったら終了

## 実行してみよう

```bash
task run02
```

- 名前を入力してEnterキー
- ↑↓キーでコマンドを選択
- Enterキーで決定
- Rキーでリトライ、Qキーで終了

## 練習問題

1. スライムの色を変えてみよう（`GREEN`を他の色に）
2. ダメージの範囲を変えてみよう（±5を±10に）
3. 新しいコマンド「ぼうぎょ」を追加してみよう

## 次回予告

次の章では、複数の敵と連続で戦えるようにします！
スライム、ゴブリン、オークと順番に戦っていきますよ。