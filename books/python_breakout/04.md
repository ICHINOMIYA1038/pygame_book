---
title: "ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã¹ã‚ˆã†"
---

# 04: ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã¹ã‚ˆã†

ã“ã®ã—ã‚‡ã†ã§ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”»é¢ã«ä¸¦ã¹ã¦ã€ãƒœãƒ¼ãƒ«ãŒå½“ãŸã£ãŸã‚‰ãƒ–ãƒ­ãƒƒã‚¯ãŒæ¶ˆãˆã‚‹ä»•çµ„ã¿ã‚’ä½œã‚Šã¾ã™ã€‚

:::message
**ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§å­¦ã¶ã“ã¨**
- ãƒªã‚¹ãƒˆï¼ˆé…åˆ—ï¼‰ã‚’ä½¿ã£ã¦è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•
- äºŒé‡ãƒ«ãƒ¼ãƒ—ï¼ˆforæ–‡ã®ä¸­ã®foræ–‡ï¼‰ã§æ ¼å­çŠ¶ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®
- `pygame.sprite.Group` ã‚’ä½¿ã£ãŸè¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç®¡ç†
- `spritecollide()` é–¢æ•°ã§è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã®è¡çªåˆ¤å®š
:::

## ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚‚ãã¦ã

- ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”»é¢ã«ä¸¦ã¹ã‚‹
- ãƒœãƒ¼ãƒ«ãŒãƒ–ãƒ­ãƒƒã‚¯ã«å½“ãŸã£ãŸã‚‰ã€ãƒ–ãƒ­ãƒƒã‚¯ãŒæ¶ˆãˆã‚‹
- ãƒœãƒ¼ãƒ«ã¯ãƒ–ãƒ­ãƒƒã‚¯ã§è·³ã­è¿”ã‚‹

![ç¬¬4ç« ã®å®Ÿè¡Œçµæœ](/images/python_breakout/chapter04.png)

## ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. è‰²ã®ãƒªã‚¹ãƒˆã‚’ä½œã‚‹

```python
# ãƒ–ãƒ­ãƒƒã‚¯ã®è‰²ãƒªã‚¹ãƒˆ
BLOCK_COLORS = [
    (255, 100, 100),  # èµ¤
    (255, 200, 100),  # ã‚ªãƒ¬ãƒ³ã‚¸
    (255, 255, 100),  # é»„è‰²
    (100, 255, 100),  # ç·‘
    (100, 200, 255),  # æ°´è‰²
]
```

- ãƒªã‚¹ãƒˆï¼ˆé…åˆ—ï¼‰ã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã®è‰²ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™
- `BLOCK_COLORS[0]` ã§èµ¤ã€`BLOCK_COLORS[1]` ã§ã‚ªãƒ¬ãƒ³ã‚¸ã‚’å–ã‚Šå‡ºã›ã¾ã™

:::details ğŸ’¡ ãƒªã‚¹ãƒˆï¼ˆListï¼‰ã£ã¦ãªã«ï¼Ÿ
ãƒªã‚¹ãƒˆã¯ã€ãŸãã•ã‚“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã²ã¨ã¤ã«ã¾ã¨ã‚ãŸ **ã€Œæ•´ç†ç®±ã€** ã§ã™ã€‚
`[]` ã®ä¸­ã«ã‚«ãƒ³ãƒ `,` ã§åŒºåˆ‡ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¾ã™ã€‚
ç®±ã®ä¸­èº«ã«ã¯ã€Œ0ç•ªã€ã‹ã‚‰å§‹ã¾ã‚‹ç•ªå·ãŒã¤ã„ã¦ã„ã‚‹ã®ã§ã€`BLOCK_COLORS[0]` ã®ã‚ˆã†ã«ç•ªå·ã‚’æŒ‡å®šã—ã¦ä¸­èº«ã‚’å–ã‚Šå‡ºã—ã¾ã™ã€‚
:::

- è¡Œã”ã¨ã«è‰²ã‚’å¤‰ãˆã‚‹ãŸã‚ã«ä½¿ã„ã¾ã™

### 2. ãƒ–ãƒ­ãƒƒã‚¯ã®è¨­å®š

```python
# ãƒ–ãƒ­ãƒƒã‚¯ã®è¨­å®š
BLOCK_WIDTH = 58
BLOCK_HEIGHT = 20
BLOCK_ROWS = 5      # ç¸¦ã«5è¡Œ
BLOCK_COLS = 8      # æ¨ªã«8åˆ—
BLOCK_MARGIN = 2    # ãƒ–ãƒ­ãƒƒã‚¯é–“ã®éš™é–“
BLOCK_TOP_MARGIN = 60  # ä¸Šã‹ã‚‰ã®ä½™ç™½
```

- ãƒ–ãƒ­ãƒƒã‚¯ã®å¤§ãã•ã‚„é…ç½®ã«é–¢ã™ã‚‹è¨­å®šã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™
- å®šæ•°ã«ã—ã¦ãŠãã¨ã€å¾Œã§èª¿æ•´ã™ã‚‹ã¨ãã«ä¾¿åˆ©ã§ã™

### 3. ãƒ–ãƒ­ãƒƒã‚¯ã‚¯ãƒ©ã‚¹

```python
class Block(pygame.sprite.Sprite):
    """å£Šã•ã‚Œã‚‹ãƒ–ãƒ­ãƒƒã‚¯"""

    def __init__(self, x, y, color):
        super().__init__()
        self.image = pygame.Surface((BLOCK_WIDTH, BLOCK_HEIGHT))
        self.image.fill(color)
        self.rect = self.image.get_rect()
        self.rect.x = x
        self.rect.y = y
```

- ãƒ–ãƒ­ãƒƒã‚¯ã¯ `x`, `y`, `color` ã‚’å—ã‘å–ã£ã¦ä½œæˆã—ã¾ã™
- å„ãƒ–ãƒ­ãƒƒã‚¯ãŒç•°ãªã‚‹ä½ç½®ã¨è‰²ã‚’æŒã¦ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™

### 4. ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã¹ã‚‹é–¢æ•°

```python
def create_blocks():
    """ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã¹ã¦ä½œæˆã™ã‚‹"""
    blocks = pygame.sprite.Group()

    for row in range(BLOCK_ROWS):
        for col in range(BLOCK_COLS):
            # ãƒ–ãƒ­ãƒƒã‚¯ã®ä½ç½®ã‚’è¨ˆç®—
            x = col * (BLOCK_WIDTH + BLOCK_MARGIN) + BLOCK_MARGIN
            y = row * (BLOCK_HEIGHT + BLOCK_MARGIN) + BLOCK_TOP_MARGIN

            # è¡Œã”ã¨ã«è‰²ã‚’å¤‰ãˆã‚‹
            color = BLOCK_COLORS[row % len(BLOCK_COLORS)]

            block = Block(x, y, color)
            blocks.add(block)

    return blocks
```

- **äºŒé‡ãƒ«ãƒ¼ãƒ—** ã§ã€è¡Œã¨åˆ—ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚’é…ç½®ã—ã¦ã„ã¾ã™

:::details ğŸ’¡ äºŒé‡ãƒ«ãƒ¼ãƒ—ï¼ˆNested Loopï¼‰ã£ã¦ãªã«ï¼Ÿ
ãƒ«ãƒ¼ãƒ—ï¼ˆç¹°ã‚Šè¿”ã—ï¼‰ã®ä¸­ã«ã€ã‚‚ã†ã²ã¨ã¤ãƒ«ãƒ¼ãƒ—ãŒå…¥ã£ã¦ã„ã‚‹å½¢ã§ã™ã€‚
å­¦æ ¡ã®æ•™å®¤ã§ä¾‹ãˆã‚‹ã¨...
1. **å¤–å´ã®ãƒ«ãƒ¼ãƒ—**ï¼š ã€Œ1åˆ—ç›®ã®ã€ã€
    2. **å†…å´ã®ãƒ«ãƒ¼ãƒ—**ï¼š ã€Œå‰ã‹ã‚‰é †ç•ªã«å¸­ã«ã¤ãï¼ˆ1ç•ªã€2ç•ªã€3ç•ª...ï¼‰ã€
3. **å¤–å´ã®ãƒ«ãƒ¼ãƒ—**ï¼š ã€Œã¯ã„æ¬¡ã€2åˆ—ç›®ã®ã€ã€
    4. **å†…å´ã®ãƒ«ãƒ¼ãƒ—**ï¼š ã€Œå‰ã‹ã‚‰é †ç•ªã«å¸­ã«ã¤ã...ã€

ã“ã®ã‚ˆã†ã«ã€**ã€Œç¸¦ã€ã¨ã€Œæ¨ªã€** ã®ã‚ˆã†ã«2ã¤ã®æ–¹å‘ã«ä¸¦ã¹ãŸã„ã¨ãã«ã‚ˆãä½¿ã„ã¾ã™ã€‚
:::

- `range(5)` ã¯ 0, 1, 2, 3, 4 ã®5ã¤ã®æ•°ã‚’é †ç•ªã«è¿”ã—ã¾ã™
- `col * (BLOCK_WIDTH + BLOCK_MARGIN)` ã§ã€ãƒ–ãƒ­ãƒƒã‚¯ã®æ¨ªä½ç½®ã‚’è¨ˆç®—ã—ã¦ã„ã¾ã™

:::message alert
**% æ¼”ç®—å­ï¼ˆä½™ã‚Šã®è¨ˆç®—ï¼‰**

`row % len(BLOCK_COLORS)` ã¯ã€Œè¡Œç•ªå·ã‚’è‰²ã®æ•°ã§å‰²ã£ãŸä½™ã‚Šã€ã§ã™ã€‚

- row=0: 0 % 5 = 0 â†’ èµ¤
- row=1: 1 % 5 = 1 â†’ ã‚ªãƒ¬ãƒ³ã‚¸
- row=2: 2 % 5 = 2 â†’ é»„è‰²
- row=5: 5 % 5 = 0 â†’ èµ¤ï¼ˆã¾ãŸæœ€åˆã«æˆ»ã‚‹ï¼‰

ã“ã‚Œã§è‰²ã‚’ç¹°ã‚Šè¿”ã—ä½¿ãˆã¾ã™ã€‚
:::

### 5. ãƒ–ãƒ­ãƒƒã‚¯ã¨ã®è¡çªåˆ¤å®š

```python
# ãƒ–ãƒ­ãƒƒã‚¯ã¨ã®è¡çª
hit_blocks = pygame.sprite.spritecollide(ball, block_group, True)
if hit_blocks:
    ball.dy = -ball.dy
```

- `spritecollide()` ã¯ã€1ã¤ã®ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã¨ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã®è¡çªã‚’åˆ¤å®šã—ã¾ã™
- ç¬¬3å¼•æ•°ã® `True` ã¯ã€Œè¡çªã—ãŸã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™
- æˆ»ã‚Šå€¤ `hit_blocks` ã¯ã€è¡çªã—ãŸãƒ–ãƒ­ãƒƒã‚¯ã®ãƒªã‚¹ãƒˆã§ã™
- è¡çªã—ãŸãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚Œã°ã€ãƒœãƒ¼ãƒ«ã®ç¸¦æ–¹å‘ã‚’åè»¢ã•ã›ã¾ã™

### 6. ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã®ãƒ–ãƒ­ãƒƒã‚¯å†ç”Ÿæˆ

```python
if event.key == pygame.K_r and game_over:
    ball.reset()
    block_group = create_blocks()  # ãƒ–ãƒ­ãƒƒã‚¯ã‚’å†ç”Ÿæˆ
    game_over = False
```

- ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚‚æ–°ã—ãä½œã‚Šç›´ã—ã¾ã™

## æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰

```python
import pygame
import sys

# ç”»é¢ã‚µã‚¤ã‚º
SCREEN_WIDTH = 480
SCREEN_HEIGHT = 640

# è‰²ã®å®šç¾©
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
BLUE = (0, 128, 255)
RED = (255, 100, 100)

# ãƒ–ãƒ­ãƒƒã‚¯ã®è‰²ãƒªã‚¹ãƒˆ
BLOCK_COLORS = [
    (255, 100, 100),  # èµ¤
    (255, 200, 100),  # ã‚ªãƒ¬ãƒ³ã‚¸
    (255, 255, 100),  # é»„è‰²
    (100, 255, 100),  # ç·‘
    (100, 200, 255),  # æ°´è‰²
]

# ãƒ‘ãƒ‰ãƒ«ã®è¨­å®š
PADDLE_WIDTH = 80
PADDLE_HEIGHT = 15

# ãƒœãƒ¼ãƒ«ã®è¨­å®š
BALL_SIZE = 12

# ãƒ–ãƒ­ãƒƒã‚¯ã®è¨­å®š
BLOCK_WIDTH = 58
BLOCK_HEIGHT = 20
BLOCK_ROWS = 5
BLOCK_COLS = 8
BLOCK_MARGIN = 2
BLOCK_TOP_MARGIN = 60


class Paddle(pygame.sprite.Sprite):
    """ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ“ä½œã™ã‚‹ãƒ‘ãƒ‰ãƒ«ï¼ˆæ¿ï¼‰"""

    def __init__(self):
        super().__init__()
        self.image = pygame.Surface((PADDLE_WIDTH, PADDLE_HEIGHT))
        self.image.fill(BLUE)
        self.rect = self.image.get_rect()
        self.rect.centerx = SCREEN_WIDTH // 2
        self.rect.bottom = SCREEN_HEIGHT - 30
        self.speed = 8

    def update(self):
        keys = pygame.key.get_pressed()
        if keys[pygame.K_LEFT]:
            self.rect.x -= self.speed
        if keys[pygame.K_RIGHT]:
            self.rect.x += self.speed
        if self.rect.left < 0:
            self.rect.left = 0
        if self.rect.right > SCREEN_WIDTH:
            self.rect.right = SCREEN_WIDTH


class Ball(pygame.sprite.Sprite):
    """å‹•ãå›ã‚‹ãƒœãƒ¼ãƒ«"""

    def __init__(self):
        super().__init__()
        self.image = pygame.Surface((BALL_SIZE, BALL_SIZE))
        self.image.fill(WHITE)
        self.rect = self.image.get_rect()
        self.reset()

    def reset(self):
        self.rect.centerx = SCREEN_WIDTH // 2
        self.rect.centery = SCREEN_HEIGHT // 2
        self.dx = 4
        self.dy = -4

    def update(self):
        self.rect.x += self.dx
        self.rect.y += self.dy

        if self.rect.left <= 0:
            self.rect.left = 0
            self.dx = -self.dx
        if self.rect.right >= SCREEN_WIDTH:
            self.rect.right = SCREEN_WIDTH
            self.dx = -self.dx
        if self.rect.top <= 0:
            self.rect.top = 0
            self.dy = -self.dy

    def is_out(self):
        return self.rect.top >= SCREEN_HEIGHT


class Block(pygame.sprite.Sprite):
    """å£Šã•ã‚Œã‚‹ãƒ–ãƒ­ãƒƒã‚¯"""

    def __init__(self, x, y, color):
        super().__init__()
        self.image = pygame.Surface((BLOCK_WIDTH, BLOCK_HEIGHT))
        self.image.fill(color)
        self.rect = self.image.get_rect()
        self.rect.x = x
        self.rect.y = y


def create_blocks():
    """ãƒ–ãƒ­ãƒƒã‚¯ã‚’ä¸¦ã¹ã¦ä½œæˆã™ã‚‹"""
    blocks = pygame.sprite.Group()

    for row in range(BLOCK_ROWS):
        for col in range(BLOCK_COLS):
            # ãƒ–ãƒ­ãƒƒã‚¯ã®ä½ç½®ã‚’è¨ˆç®—
            x = col * (BLOCK_WIDTH + BLOCK_MARGIN) + BLOCK_MARGIN
            y = row * (BLOCK_HEIGHT + BLOCK_MARGIN) + BLOCK_TOP_MARGIN

            # è¡Œã”ã¨ã«è‰²ã‚’å¤‰ãˆã‚‹
            color = BLOCK_COLORS[row % len(BLOCK_COLORS)]

            block = Block(x, y, color)
            blocks.add(block)

    return blocks


def main():
    pygame.init()
    screen = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
    pygame.display.set_caption("ãƒ–ãƒ­ãƒƒã‚¯å´©ã— - 04")

    font = pygame.font.Font(None, 48)

    # ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    paddle = Paddle()
    ball = Ball()
    paddle_group = pygame.sprite.Group(paddle)
    ball_group = pygame.sprite.Group(ball)
    block_group = create_blocks()

    clock = pygame.time.Clock()
    game_over = False

    while True:
        clock.tick(60)

        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_r and game_over:
                    ball.reset()
                    block_group = create_blocks()
                    game_over = False

        if not game_over:
            paddle_group.update()
            ball_group.update()

            # ãƒ‘ãƒ‰ãƒ«ã¨ã®è¡çª
            if ball.rect.colliderect(paddle.rect):
                ball.rect.bottom = paddle.rect.top
                ball.dy = -abs(ball.dy)

            # ãƒ–ãƒ­ãƒƒã‚¯ã¨ã®è¡çª
            hit_blocks = pygame.sprite.spritecollide(ball, block_group, True)
            if hit_blocks:
                ball.dy = -ball.dy

            if ball.is_out():
                game_over = True

        # æç”»
        screen.fill(BLACK)
        block_group.draw(screen)
        paddle_group.draw(screen)
        ball_group.draw(screen)

        if game_over:
            text = font.render("GAME OVER", True, RED)
            text_rect = text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2))
            screen.blit(text, text_rect)

            restart_text = font.render("Press R to Restart", True, WHITE)
            restart_rect = restart_text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 50))
            screen.blit(restart_text, restart_rect)

        pygame.display.flip()


if __name__ == "__main__":
    main()
```

## ã¾ã¨ã‚

ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯å´©ã—ã®æ ¸ã¨ãªã‚‹ã€Œãƒ–ãƒ­ãƒƒã‚¯ã€ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

- **ãƒªã‚¹ãƒˆ** ã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã®è‰²ã‚’ç®¡ç†ã—ã¾ã—ãŸ
- **äºŒé‡ãƒ«ãƒ¼ãƒ—** ã§ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’æ ¼å­çŠ¶ã«é…ç½®ã—ã¾ã—ãŸ
- **spritecollide()** ã§ã€è¤‡æ•°ã®ãƒ–ãƒ­ãƒƒã‚¯ã¨ã®è¡çªã‚’ä¸€åº¦ã«åˆ¤å®šã—ã¾ã—ãŸ
- **% æ¼”ç®—å­** ã§ã€è‰²ã‚’ç¹°ã‚Šè¿”ã—ä½¿ã†æ–¹æ³•ã‚’å­¦ã³ã¾ã—ãŸ

![ãƒãƒ£ãƒ—ã‚¿ãƒ¼4ã®ã¾ã¨ã‚](/images/python_breakout/summary_04.png)

æ¬¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯ã€ã‚¹ã‚³ã‚¢è¡¨ç¤ºã¨ã‚¯ãƒªã‚¢åˆ¤å®šã‚’è¿½åŠ ã—ã¦ã‚²ãƒ¼ãƒ ã‚’å®Œæˆã•ã›ã¾ã™ã€‚
