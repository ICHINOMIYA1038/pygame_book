---
title: "ãƒ‘ãƒ‰ãƒ«ã§ãƒœãƒ¼ãƒ«ã‚’æ‰“ã¡è¿”ãã†"
---

# 03: ãƒ‘ãƒ‰ãƒ«ã§ãƒœãƒ¼ãƒ«ã‚’æ‰“ã¡è¿”ãã†

ã“ã®ã—ã‚‡ã†ã§ã¯ã€ãƒ‘ãƒ‰ãƒ«ã¨ãƒœãƒ¼ãƒ«ã®ã€Œè¡çªåˆ¤å®šï¼ˆã—ã‚‡ã†ã¨ã¤ã¯ã‚“ã¦ã„ï¼‰ã€ã‚’å®Ÿè£…ã—ã€ãƒœãƒ¼ãƒ«ã‚’æ‰“ã¡è¿”ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã¾ãŸã€ãƒœãƒ¼ãƒ«ã‚’è½ã¨ã—ãŸã‚‰ã€Œã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã€ã«ãªã‚‹ä»•çµ„ã¿ã‚‚ä½œã‚Šã¾ã™ã€‚

:::message
**ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§å­¦ã¶ã“ã¨**
- 2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã¶ã¤ã‹ã£ãŸã‹ã‚’åˆ¤å®šã™ã‚‹ã€Œè¡çªåˆ¤å®šã€
- `colliderect()` é–¢æ•°ã®ä½¿ã„æ–¹
- ã‚²ãƒ¼ãƒ ã®ã€ŒçŠ¶æ…‹ã€ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ï¼ˆãƒ—ãƒ¬ã‚¤ä¸­ / ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼‰
- ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹æ–¹æ³•
:::

## ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚‚ãã¦ã

- ãƒ‘ãƒ‰ãƒ«ã§ãƒœãƒ¼ãƒ«ã‚’æ‰“ã¡è¿”ã™
- ãƒœãƒ¼ãƒ«ã‚’è½ã¨ã—ãŸã‚‰ã€Œã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã€ã‚’è¡¨ç¤º
- Rã‚­ãƒ¼ã§ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

![ç¬¬3ç« ã®å®Ÿè¡Œçµæœ](/images/python_breakout/chapter03.png)

## ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. ãƒœãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°

```python
class Ball(pygame.sprite.Sprite):
    def __init__(self):
        super().__init__()
        self.image = pygame.Surface((BALL_SIZE, BALL_SIZE))
        self.image.fill(WHITE)
        self.rect = self.image.get_rect()
        self.reset()

    def reset(self):
        """ãƒœãƒ¼ãƒ«ã‚’åˆæœŸä½ç½®ã«æˆ»ã™"""
        self.rect.centerx = SCREEN_WIDTH // 2
        self.rect.centery = SCREEN_HEIGHT // 2
        self.dx = 4
        self.dy = -4
```

- `reset()` é–¢æ•°ã‚’ä½œã£ã¦ã€ãƒœãƒ¼ãƒ«ã‚’åˆæœŸä½ç½®ã«æˆ»ã™å‡¦ç†ã‚’ã¾ã¨ã‚ã¾ã—ãŸ
- `__init__` ã§ã‚‚ `reset()` ã‚’å‘¼ã³å‡ºã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’é¿ã‘ã¦ã„ã¾ã™
- ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã« `ball.reset()` ã‚’å‘¼ã¶ã ã‘ã§æ¸ˆã¿ã¾ã™

### 2. ãƒœãƒ¼ãƒ«ãŒè½ã¡ãŸã‹åˆ¤å®š

```python
def is_out(self):
    """ãƒœãƒ¼ãƒ«ãŒç”»é¢ä¸‹ã«è½ã¡ãŸã‹åˆ¤å®š"""
    return self.rect.top >= SCREEN_HEIGHT
```

- ãƒœãƒ¼ãƒ«ã®ä¸Šç«¯ï¼ˆ`rect.top`ï¼‰ãŒç”»é¢ã®é«˜ã•ã‚’è¶…ãˆãŸã‚‰ `True` ã‚’è¿”ã—ã¾ã™
- `return` æ–‡ã¯ã€æ¡ä»¶å¼ã®çµæœï¼ˆTrue/Falseï¼‰ã‚’ãã®ã¾ã¾è¿”ã—ã¾ã™

### 3. ãƒ‘ãƒ‰ãƒ«ã¨ãƒœãƒ¼ãƒ«ã®è¡çªåˆ¤å®š

```python
# ãƒ‘ãƒ‰ãƒ«ã¨ãƒœãƒ¼ãƒ«ã®è¡çªåˆ¤å®š
if ball.rect.colliderect(paddle.rect):
    # ãƒœãƒ¼ãƒ«ã‚’ãƒ‘ãƒ‰ãƒ«ã®ä¸Šã«æŠ¼ã—æˆ»ã™
    ball.rect.bottom = paddle.rect.top
    # ä¸Šæ–¹å‘ã«è·³ã­è¿”ã™
    ball.dy = -abs(ball.dy)
```

- `colliderect()` ã¯ã€2ã¤ã®å››è§’å½¢ãŒé‡ãªã£ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ã§ã™
- é‡ãªã£ã¦ã„ã‚Œã° `True`ã€é‡ãªã£ã¦ã„ãªã‘ã‚Œã° `False` ã‚’è¿”ã—ã¾ã™
- `abs(ball.dy)` ã¯çµ¶å¯¾å€¤ã‚’å–ã‚‹é–¢æ•°ã§ã€`-abs(ball.dy)` ã§å¿…ãšä¸Šå‘ãï¼ˆè² ã®å€¤ï¼‰ã«ãªã‚Šã¾ã™

:::message alert
**ãªãœ `-abs(ball.dy)` ã‚’ä½¿ã†ã®ã‹ï¼Ÿ**

å˜ç´”ã« `ball.dy = -ball.dy` ã ã¨ã€ãƒ‘ãƒ‰ãƒ«ã«å½“ãŸã‚Šç¶šã‘ãŸå ´åˆã«ä¸Šä¸‹ã«æŒ¯å‹•ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
`-abs(ball.dy)` ã‚’ä½¿ãˆã°ã€ä½•åº¦å½“ãŸã£ã¦ã‚‚å¿…ãšä¸Šå‘ãã«ãªã‚Šã¾ã™ã€‚
:::

### 4. ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†

```python
# ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹
game_over = False

while True:
    # ...çœç•¥...

    if not game_over:
        # æ›´æ–°å‡¦ç†
        paddle_group.update()
        ball_group.update()

        # è¡çªåˆ¤å®š
        if ball.rect.colliderect(paddle.rect):
            ball.rect.bottom = paddle.rect.top
            ball.dy = -abs(ball.dy)

        # ãƒœãƒ¼ãƒ«ãŒè½ã¡ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        if ball.is_out():
            game_over = True
```

- `game_over` å¤‰æ•°ã§ã€ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™

:::details ğŸ’¡ ãƒ•ãƒ©ã‚°ï¼ˆFlagï¼‰ã£ã¦ãªã«ï¼Ÿ
`True`ï¼ˆæ­£ã—ã„ï¼‰ã‹ `False`ï¼ˆé–“é•ã„ï¼‰ã®ã©ã¡ã‚‰ã‹ã—ã‹å…¥ã‚‰ãªã„å¤‰æ•°ã®ã“ã¨ã‚’ã€**ãƒ•ãƒ©ã‚°ï¼ˆæ——ï¼‰** ã¨å‘¼ã³ã¾ã™ã€‚
ã€Œæ——ãŒä¸ŠãŒã£ã¦ã„ã‚‹ï¼ˆTrueï¼‰ï¼ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã€ã€Œæ——ãŒä¸‹ãŒã£ã¦ã„ã‚‹ï¼ˆFalseï¼‰ï¼ãƒ—ãƒ¬ã‚¤ä¸­ã€ã®ã‚ˆã†ã«ã€
**ã‚¹ã‚¤ãƒƒãƒã® ON / OFF** ã¨ã—ã¦ä½¿ã„ã¾ã™ã€‚
:::

- `if not game_over:` ã¯ã€Œã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ãªã‘ã‚Œã°ã€ã¨ã„ã†æ„å‘³ã§ã™
- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ä¸­ã¯ã€æ›´æ–°å‡¦ç†ã‚’æ­¢ã‚ã¦ç”»é¢ã‚’å›ºå®šã—ã¾ã™

### 5. ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã®è¡¨ç¤º

```python
# ãƒ•ã‚©ãƒ³ãƒˆã®æº–å‚™
font = pygame.font.Font(None, 48)

# ...çœç•¥...

# ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤º
if game_over:
    text = font.render("GAME OVER", True, RED)
    text_rect = text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2))
    screen.blit(text, text_rect)
```

- `pygame.font.Font(None, 48)` ã§ãƒ•ã‚©ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼ˆNone ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆï¼‰
- `font.render()` ã§æ–‡å­—åˆ—ã‚’ç”»åƒã«å¤‰æ›ã—ã¾ã™
- `screen.blit()` ã§ç”»åƒã‚’ç”»é¢ã«æç”»ã—ã¾ã™

### 6. ãƒªã‚¹ã‚¿ãƒ¼ãƒˆå‡¦ç†

```python
for event in pygame.event.get():
    # ...çœç•¥...
    if event.type == pygame.KEYDOWN:
        if event.key == pygame.K_r and game_over:
            ball.reset()
            game_over = False
```

- `pygame.KEYDOWN` ã¯ã€Œã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸç¬é–“ã€ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ã™
- Rã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã€ã‹ã¤ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼çŠ¶æ…‹ãªã‚‰ã€ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™

## æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰

```python
import pygame
import sys

# ç”»é¢ã‚µã‚¤ã‚º
SCREEN_WIDTH = 480
SCREEN_HEIGHT = 640

# è‰²ã®å®šç¾©
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
BLUE = (0, 128, 255)
RED = (255, 100, 100)

# ãƒ‘ãƒ‰ãƒ«ã®è¨­å®š
PADDLE_WIDTH = 80
PADDLE_HEIGHT = 15

# ãƒœãƒ¼ãƒ«ã®è¨­å®š
BALL_SIZE = 12


class Paddle(pygame.sprite.Sprite):
    """ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ“ä½œã™ã‚‹ãƒ‘ãƒ‰ãƒ«ï¼ˆæ¿ï¼‰"""

    def __init__(self):
        super().__init__()
        self.image = pygame.Surface((PADDLE_WIDTH, PADDLE_HEIGHT))
        self.image.fill(BLUE)
        self.rect = self.image.get_rect()
        self.rect.centerx = SCREEN_WIDTH // 2
        self.rect.bottom = SCREEN_HEIGHT - 30
        self.speed = 8

    def update(self):
        """ã‚­ãƒ¼å…¥åŠ›ã§ãƒ‘ãƒ‰ãƒ«ã‚’å·¦å³ã«å‹•ã‹ã™"""
        keys = pygame.key.get_pressed()

        if keys[pygame.K_LEFT]:
            self.rect.x -= self.speed
        if keys[pygame.K_RIGHT]:
            self.rect.x += self.speed

        if self.rect.left < 0:
            self.rect.left = 0
        if self.rect.right > SCREEN_WIDTH:
            self.rect.right = SCREEN_WIDTH


class Ball(pygame.sprite.Sprite):
    """å‹•ãå›ã‚‹ãƒœãƒ¼ãƒ«"""

    def __init__(self):
        super().__init__()
        self.image = pygame.Surface((BALL_SIZE, BALL_SIZE))
        self.image.fill(WHITE)
        self.rect = self.image.get_rect()
        self.reset()

    def reset(self):
        """ãƒœãƒ¼ãƒ«ã‚’åˆæœŸä½ç½®ã«æˆ»ã™"""
        self.rect.centerx = SCREEN_WIDTH // 2
        self.rect.centery = SCREEN_HEIGHT // 2
        self.dx = 4
        self.dy = -4

    def update(self):
        """ãƒœãƒ¼ãƒ«ã‚’å‹•ã‹ã—ã¦ã€å£ã§è·³ã­è¿”ã™"""
        self.rect.x += self.dx
        self.rect.y += self.dy

        # å·¦å³ã®å£ã§è·³ã­è¿”ã‚‹
        if self.rect.left <= 0:
            self.rect.left = 0
            self.dx = -self.dx
        if self.rect.right >= SCREEN_WIDTH:
            self.rect.right = SCREEN_WIDTH
            self.dx = -self.dx

        # ä¸Šã®å£ã§è·³ã­è¿”ã‚‹
        if self.rect.top <= 0:
            self.rect.top = 0
            self.dy = -self.dy

    def is_out(self):
        """ãƒœãƒ¼ãƒ«ãŒç”»é¢ä¸‹ã«è½ã¡ãŸã‹åˆ¤å®š"""
        return self.rect.top >= SCREEN_HEIGHT


def main():
    pygame.init()
    screen = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
    pygame.display.set_caption("ãƒ–ãƒ­ãƒƒã‚¯å´©ã— - 03")

    # ãƒ•ã‚©ãƒ³ãƒˆã®æº–å‚™
    font = pygame.font.Font(None, 48)

    # ãƒ‘ãƒ‰ãƒ«ã¨ãƒœãƒ¼ãƒ«ã‚’ä½œæˆ
    paddle = Paddle()
    ball = Ball()
    paddle_group = pygame.sprite.Group(paddle)
    ball_group = pygame.sprite.Group(ball)

    clock = pygame.time.Clock()

    # ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹
    game_over = False

    while True:
        clock.tick(60)

        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
            # ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«Rã‚­ãƒ¼ã§ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_r and game_over:
                    ball.reset()
                    game_over = False

        if not game_over:
            # æ›´æ–°
            paddle_group.update()
            ball_group.update()

            # ãƒ‘ãƒ‰ãƒ«ã¨ãƒœãƒ¼ãƒ«ã®è¡çªåˆ¤å®š
            if ball.rect.colliderect(paddle.rect):
                # ãƒœãƒ¼ãƒ«ã‚’ãƒ‘ãƒ‰ãƒ«ã®ä¸Šã«æŠ¼ã—æˆ»ã™
                ball.rect.bottom = paddle.rect.top
                # ä¸Šæ–¹å‘ã«è·³ã­è¿”ã™
                ball.dy = -abs(ball.dy)

            # ãƒœãƒ¼ãƒ«ãŒè½ã¡ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
            if ball.is_out():
                game_over = True

        # æç”»
        screen.fill(BLACK)
        paddle_group.draw(screen)
        ball_group.draw(screen)

        # ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼è¡¨ç¤º
        if game_over:
            text = font.render("GAME OVER", True, RED)
            text_rect = text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2))
            screen.blit(text, text_rect)

            restart_text = font.render("Press R to Restart", True, WHITE)
            restart_rect = restart_text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 50))
            screen.blit(restart_text, restart_rect)

        pygame.display.flip()


if __name__ == "__main__":
    main()
```

## ã¾ã¨ã‚

ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯ã€ã‚²ãƒ¼ãƒ ã‚‰ã—ã„è¦ç´ ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

- **è¡çªåˆ¤å®š** ã§ã€ãƒ‘ãƒ‰ãƒ«ã§ãƒœãƒ¼ãƒ«ã‚’æ‰“ã¡è¿”ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ
- **ã‚²ãƒ¼ãƒ çŠ¶æ…‹** ã‚’å¤‰æ•°ã§ç®¡ç†ã—ã€ãƒ—ãƒ¬ã‚¤ä¸­/ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ
- **ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º** ã§ã€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‚’ç”»é¢ã«è¡¨ç¤ºã—ã¾ã—ãŸ
- **ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½** ã§ã€ä½•åº¦ã§ã‚‚éŠã¹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

![ãƒãƒ£ãƒ—ã‚¿ãƒ¼3ã®ã¾ã¨ã‚](/images/python_breakout/summary_03.png)

æ¬¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’é…ç½®ã—ã¦å£Šã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
